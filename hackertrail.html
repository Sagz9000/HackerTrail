<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hacker Trail: Pac-Man Boss (v2.8)</title>
    <style>
        /* --- THEME: HACKERS (1995) --- */
        :root {
            --bg: #050505;
            --green: #00ff00;
            --cyan: #00ffff;
            /* Zero Cool */
            --orange: #ffaa00;
            /* Acid Burn */
            --red: #ff3333;
            /* The Plague */
            --dim: #004400;
        }

        @font-face {
            font-family: 'VT323';
            src: url('https://fonts.gstatic.com/s/vt323/v17/pxiKyp0ihIEF2isRF535.woff2') format('woff2');
        }

        * {
            box-sizing: border-box;
            user-select: none;
        }

        body {
            margin: 0;
            padding: 0;
            background: #000;
            color: var(--green);
            font-family: 'VT323', monospace;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #monitor {
            width: 95vw;
            height: 95vh;
            max-width: 1200px;
            max-height: 900px;
            background: #111;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8);
            display: flex;
            flex-direction: column;
            border: 1px solid #333;
            position: relative;
        }

        #screen {
            flex-grow: 1;
            width: 100%;
            background: var(--bg);
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 100px rgba(0, 0, 0, 0.9);
            border: 2px solid #555;
        }

        /* Scanlines */
        #screen::before {
            content: " ";
            pointer-events: none;
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%),
                linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            z-index: 10;
            background-size: 100% 2px, 3px 100%;
        }

        #ui-layer {
            position: relative;
            z-index: 5;
            height: 100%;
            padding: 20px;
            display: flex;
            flex-direction: column;
            animation: flicker 0.15s infinite;
            text-shadow: 0 0 4px var(--green);
        }

        @keyframes flicker {
            0% {
                opacity: 0.97;
            }

            50% {
                opacity: 0.99;
            }

            100% {
                opacity: 0.94;
            }
        }

        /* Typography */
        .cool {
            color: var(--cyan);
            text-shadow: 0 0 5px var(--cyan);
        }

        .burn {
            color: var(--orange);
            text-shadow: 0 0 5px var(--orange);
        }

        .plague {
            color: var(--red);
            text-shadow: 0 0 5px var(--red);
        }

        .instruction {
            color: #fff;
            background: #222;
            padding: 2px 5px;
            font-size: 1rem;
            border: 1px solid var(--dim);
            display: inline-block;
            margin-bottom: 5px;
        }

        .header,
        .status-bar {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 2px solid var(--green);
            font-size: 1.2rem;
            flex-shrink: 0;
        }

        .status-bar {
            border-bottom: none;
            border-top: 2px solid var(--green);
        }

        .main-display {
            flex-grow: 1;
            border: 1px dashed var(--dim);
            padding: 15px;
            overflow-y: auto;
            margin: 15px 0;
            font-size: 1.2rem;
            position: relative;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #000;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--dim);
        }

        button {
            background: transparent;
            color: var(--green);
            border: 2px solid var(--green);
            padding: 8px 16px;
            font-family: inherit;
            font-size: 1.1rem;
            cursor: pointer;
            text-transform: uppercase;
            margin: 5px;
            transition: 0.1s;
            box-shadow: 0 0 5px var(--dim);
        }

        button:hover {
            background: var(--green);
            color: #000;
            box-shadow: 0 0 15px var(--green);
        }

        input {
            background: #000;
            color: #fff;
            border: 1px solid var(--green);
            padding: 5px;
            font-family: inherit;
            font-size: 1.2rem;
            text-transform: uppercase;
        }

        /* --- PACMAN CSS --- */
        #pacman-canvas {
            background: #000;
            border: 2px solid #555;
            width: 600px;
            height: 400px;
            margin: 0 auto;
            display: block;
        }

        /* OTHER MINIGAMES */
        #mining-canvas {
            width: 100%;
            height: 300px;
            position: relative;
            border: 1px solid var(--dim);
            background: repeating-linear-gradient(0deg, transparent, transparent 19px, #0f0 20px), repeating-linear-gradient(90deg, transparent, transparent 19px, #0f0 20px);
            background-size: 40px 40px;
            cursor: crosshair;
            overflow: hidden;
        }

        .data-packet {
            position: absolute;
            width: 40px;
            height: 40px;
            line-height: 40px;
            text-align: center;
            border: 2px solid var(--cyan);
            color: var(--cyan);
            background: rgba(0, 0, 0, 0.8);
            clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
            cursor: pointer;
            font-weight: bold;
            transition: 0.1s;
        }

        .data-packet:hover {
            transform: scale(1.2);
            background: #fff;
            color: #000;
        }

        .data-packet.virus {
            border-color: #f00;
            color: #f00;
        }

        #port-grid {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 5px;
            max-width: 600px;
            margin: 0 auto;
        }

        .port-cell {
            border: 1px solid #333;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: #111;
            font-size: 0.9rem;
        }

        .port-cell.open {
            background: var(--green);
            color: #000;
        }

        .port-cell.honey {
            background: var(--red);
            color: #fff;
        }

        #hex-grid {
            font-family: monospace;
            text-align: center;
            color: #666;
            font-size: 1.1rem;
        }

        .hex {
            display: inline-block;
            padding: 4px;
            cursor: pointer;
        }

        .hex:hover {
            color: var(--cyan);
            transform: scale(1.1);
        }

        #cookie-monster {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 100, 0.9);
            z-index: 100;
            text-align: center;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .eyes {
            font-size: 10rem;
            font-weight: bold;
        }

        .rabbit-win {
            position: absolute;
            width: 200px;
            height: 120px;
            background: #ccc;
            color: #000;
            border: 2px solid white;
            box-shadow: 5px 5px 0 #000;
            z-index: 50;
            text-align: center;
            font-family: 'Arial', sans-serif;
            display: flex;
            flex-direction: column;
        }

        .rabbit-bar {
            background: #000080;
            color: white;
            padding: 2px;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
        }

        .rabbit-x {
            cursor: pointer;
            background: #ccc;
            color: #000;
            padding: 0 4px;
        }

        .float-txt {
            position: absolute;
            pointer-events: none;
            animation: floatUp 0.8s forwards;
            font-weight: bold;
            font-size: 1.2rem;
        }

        @keyframes floatUp {
            to {
                transform: translateY(-40px);
                opacity: 0;
            }
        }

        .glitch {
            position: relative;
        }

        .glitch::before,
        .glitch::after {
            content: attr(data-text);
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: var(--bg);
        }

        .glitch::before {
            left: 2px;
            text-shadow: -1px 0 red;
            clip-path: inset(40% 0 61% 0);
            animation: g1 2s infinite linear alternate-reverse;
        }

        .glitch::after {
            left: -2px;
            text-shadow: -1px 0 blue;
            clip-path: inset(92% 0 1% 0);
            animation: g2 3s infinite linear alternate-reverse;
        }

        @keyframes g1 {
            0% {
                clip-path: inset(20% 0 80% 0);
            }

            100% {
                clip-path: inset(30% 0 10% 0);
            }
        }

        @keyframes g2 {
            0% {
                clip-path: inset(10% 0 60% 0);
            }

            100% {
                clip-path: inset(50% 0 30% 0);
            }
        }
    </style>
</head>

<body>

    <div id="monitor">
        <div id="screen">
            <div id="ui-layer">
                <div class="header">
                    <span id="loc-disp">TRACE: PENDING...</span>
                    <span>PATH: <span id="path-disp" class="cool">UNKNOWN</span></span>
                </div>

                <div id="main-display" class="main-display">
                    <!-- Scenes inject here -->
                </div>

                <div class="status-bar" id="stats">
                    <span>CPU: <span id="val-cpu">100%</span></span>
                    <span>$CR: <span id="val-cash">1000</span></span>
                    <span>FOOD: <span id="val-food">0</span></span>
                    <span>BW: <span id="val-bw">0</span></span>
                    <span>HEAT: <span id="val-heat">0%</span></span>
                </div>
            </div>
        </div>
    </div>

    <script>
        /**
         * HACKER TRAIL v2.8 - PAC-MAN BOSS FIGHT
         */

        const GameState = {
            MENU: 0, STORE: 1, TRAVEL: 2, EVENT: 3, ROOT_BOX: 4,
            MINING: 5, SCANNING: 6, HEXING: 7, PUZZLE: 8,
            COOKIE: 9, RABBIT: 10, PACMAN: 11, OVER: 12
        };

        const CHARACTERS = [
            { t: "ZERO COOL", text: "'Mess with the best, die like the rest.' Crash gives you a zero-day exploit.", e: (s) => { s.cpu = 100; return "FULL HEAL."; } },
            { t: "CEREAL KILLER", text: "It's a privilege, not a right. Have a pager.", e: (s) => { s.heat = Math.max(0, s.heat - 20); return "-20 HEAT."; } },
            { t: "ACID BURN", text: "Kate challenges you to a race.", e: (s) => { s.distance -= 25; s.cpu -= 5; return "-25 MILES / -5 CPU."; } },
            { t: "THE PLAGUE", text: "'There is no right and wrong.' GPI Virus detected.", e: (s) => { s.cpu -= 15; return "-15 CPU / GPI INFECTION."; } },
            { t: "LORD NIKON", text: "Photographic memory reveals the map.", e: (s) => { s.proxies++; return "+1 PROXY."; } }
        ];

        const TARGETS = [{ n: "WinXP_SP2_Legacy", v: "MS08-067" }, { n: "IoT_Smart_Fridge", v: "Default Creds" }, { n: "AWS_S3_Bucket", v: "Public Access" }];

        const Game = {
            state: GameState.MENU,
            miningInt: null, timerInt: null, timeLeft: 0,
            routersPassed: 0, currentPuz: null,

            // PACMAN VARS
            pac: { x: 1, y: 1, dx: 0, dy: 0, score: 0 },
            ghosts: [], dots: [], pacInt: null, pacGridH: 15, pacGridW: 20,

            stats: { cpu: 100, credits: 1000, food: 0, bw: 0, proxies: 0, heat: 0, distance: 250, path: "UNKNOWN" },

            init: function () {
                this.render("MENU");
                window.addEventListener('keydown', (e) => {
                    if (this.state !== GameState.PACMAN) return;
                    if (e.key === "ArrowUp") { this.pac.dx = 0; this.pac.dy = -1; }
                    if (e.key === "ArrowDown") { this.pac.dx = 0; this.pac.dy = 1; }
                    if (e.key === "ArrowLeft") { this.pac.dx = -1; this.pac.dy = 0; }
                    if (e.key === "ArrowRight") { this.pac.dx = 1; this.pac.dy = 0; }
                });
            },

            start: function () {
                this.state = GameState.STORE;
                this.stats = { cpu: 100, credits: 1500, food: 5, bw: 10, proxies: 0, heat: 0, distance: 250, path: "PUBLIC_NET" };
                this.render("STORE"); this.updateStats();
            },

            // --- LOOP ---
            travel: function () {
                if (this.stats.proxies < 1) { alert("NEED PROXY."); return; }
                let speed = 10 + (this.stats.proxies * 2);
                if (this.stats.path === "T1_BACKBONE") speed *= 1.5;
                this.stats.distance -= speed;

                if (this.stats.food > 0) this.stats.food--;
                else {
                    this.stats.cpu -= 10;
                    if (Math.random() < 0.15) { this.gameOver("DYSENTERY"); return; }
                }
                this.stats.heat += (this.stats.path === "THE_SPRAWL" ? 5 : 2);
                this.updateStats();

                if (this.stats.distance <= 0) { this.gibson(); return; }
                if (this.stats.cpu <= 0) { this.gameOver("KERNEL PANIC"); return; }
                if (this.stats.heat >= 100) { this.gameOver("BUSTED"); return; }

                const miles = 250 - this.stats.distance;
                if (miles > (this.routersPassed + 1) * 50) {
                    this.routersPassed++; this.puzzle("ROUTER"); return;
                }

                const r = Math.random();
                if (r < 0.15) this.cookieMonster();
                else if (r < 0.30) this.rabbitVirus();
                else if (r < 0.50) this.event();
                else this.render("ROOT_BOX");
            },

            // --- PACMAN BOSS ---
            startPacman: function () {
                this.state = GameState.PACMAN;
                this.render("PACMAN");
                const cw = 600, ch = 400;
                const cell = 30; // 20x13 grid roughly
                this.pacGridW = Math.floor(cw / cell); this.pacGridH = Math.floor(ch / cell);

                // Reset
                this.pac = { x: 1, y: 1, dx: 0, dy: 0, score: 0 };
                this.ghosts = [{ x: 10, y: 7, color: "red" }, { x: 12, y: 7, color: "cyan" }];
                this.dots = [];
                for (let r = 1; r < this.pacGridH - 1; r++) {
                    for (let c = 1; c < this.pacGridW - 1; c++) {
                        if ((r + c) % 2 !== 0) this.dots.push({ x: c, y: r });
                    }
                }

                const canvas = document.getElementById('pacman-canvas');
                const ctx = canvas.getContext('2d');

                this.pacInt = setInterval(() => {
                    if (this.state !== GameState.PACMAN) { clearInterval(this.pacInt); return; }

                    // Move Player
                    let nx = this.pac.x + this.pac.dx;
                    let ny = this.pac.y + this.pac.dy;
                    // Bounds
                    if (nx < 0) nx = this.pacGridW - 1; if (nx >= this.pacGridW) nx = 0;
                    if (ny < 0) ny = this.pacGridH - 1; if (ny >= this.pacGridH) ny = 0;
                    this.pac.x = nx; this.pac.y = ny;

                    // Eat Dot
                    const dotIdx = this.dots.findIndex(d => d.x === this.pac.x && d.y === this.pac.y);
                    if (dotIdx !== -1) {
                        this.dots.splice(dotIdx, 1);
                        this.pac.score += 10;
                    }

                    // Move Ghosts (Simple Chase)
                    this.ghosts.forEach(g => {
                        if (Math.random() < 0.4) {
                            if (g.x < this.pac.x) g.x++; else if (g.x > this.pac.x) g.x--;
                            else if (g.y < this.pac.y) g.y++; else if (g.y > this.pac.y) g.y--;
                        }
                        // Collision
                        if (g.x === this.pac.x && g.y === this.pac.y) {
                            this.stats.cpu -= 50; clearInterval(this.pacInt);
                            alert("CAUGHT BY DEFENDER! -50 CPU");
                            this.updateStats();
                            if (this.stats.cpu > 0) this.startPacman(); // Restart level
                            else this.gameOver("KILLED BY GIBSON ICE");
                        }
                    });

                    // Win?
                    if (this.dots.length === 0) {
                        clearInterval(this.pacInt);
                        this.victoryScreen();
                    }

                    // Draw
                    ctx.fillStyle = "#000"; ctx.fillRect(0, 0, cw, ch);

                    // Dots
                    ctx.fillStyle = "#fff";
                    this.dots.forEach(d => { ctx.beginPath(); ctx.arc(d.x * cell + cell / 2, d.y * cell + cell / 2, 4, 0, Math.PI * 2); ctx.fill(); });

                    // Ghosts
                    this.ghosts.forEach(g => {
                        ctx.fillStyle = g.color;
                        ctx.fillRect(g.x * cell + 5, g.y * cell + 5, cell - 10, cell - 10);
                    });

                    // Player
                    ctx.fillStyle = "#ff0";
                    ctx.beginPath(); ctx.arc(this.pac.x * cell + cell / 2, this.pac.y * cell + cell / 2, cell / 2 - 2, 0.2 * Math.PI, 1.8 * Math.PI); ctx.lineTo(this.pac.x * cell + cell / 2, this.pac.y * cell + cell / 2); ctx.fill();

                }, 150);
            },

            victoryScreen: function () {
                document.getElementById('main-display').innerHTML = `
        <div style="text-align:center;">
            <h1 class="cool" style="font-size:3rem">ARF ARF! GOTCHA!</h1>
            <pre>
       \\ /
      (o o)
  --ooO-(_)-Ooo--
            </pre>
            <p>GIBSON HACKED. WORM PLANTED.</p>
            <p class="burn">SCORE: ${this.pac.score}</p>
            <button onclick="location.reload()">LOG OUT</button>
        </div>`;
            },

            // --- MINIGAMES & LOGIC ---
            cookieMonster: function () {
                this.state = GameState.COOKIE; this.render("COOKIE"); const inp = document.getElementById('cookie-input'); if (inp) inp.focus();
                setTimeout(() => { if (this.state === GameState.COOKIE) { this.stats.bw = Math.floor(this.stats.bw / 2); alert("EATEN!"); this.abort(); } }, 8000);
            },
            checkCookie: function () { if (document.getElementById('cookie-input').value.toUpperCase() === "COOKIE") { this.stats.credits += 50; this.abort(); } },
            rabbitVirus: function () {
                this.state = GameState.RABBIT; this.render("RABBIT"); let count = 0;
                const spawner = setInterval(() => {
                    if (this.state !== GameState.RABBIT) { clearInterval(spawner); return; } if (count > 15) { clearInterval(spawner); this.stats.cpu -= 20; alert("CRASH!"); this.abort(); return; }
                    const w = document.createElement('div'); w.className = 'rabbit-win'; w.style.top = Math.random() * 200 + 'px'; w.style.left = Math.random() * 400 + 'px'; w.innerHTML = `<div class="rabbit-bar"><span>FLU</span><span class="rabbit-x" onclick="this.parentNode.parentNode.remove(); Game.checkRabbit()">X</span></div>`; document.getElementById('main-display').appendChild(w); count++;
                }, 600);
            },
            checkRabbit: function () { if (document.getElementsByClassName('rabbit-win').length === 0) { alert("CLEAN!"); this.abort(); } },
            mine: function () {
                this.state = GameState.MINING; this.timeLeft = 30; this.render("MINING");
                const canvas = document.getElementById('mining-canvas');
                this.timerInt = setInterval(() => { this.timeLeft--; document.getElementById('timer').innerText = this.timeLeft + "s"; if (this.timeLeft <= 0) this.abort(); }, 1000);
                this.miningInt = setInterval(() => {
                    const el = document.createElement('div'); const isVirus = Math.random() < 0.2;
                    el.className = 'data-packet ' + (isVirus ? 'virus' : ''); el.innerText = isVirus ? 'V' : (Math.random() > 0.5 ? '$' : 'D');
                    el.style.top = Math.random() * 260 + 'px'; el.style.left = '-50px';
                    let pos = -50; const spd = 2 + Math.random(); const anim = setInterval(() => { pos += spd; el.style.left = pos + 'px'; if (pos > canvas.offsetWidth) { el.remove(); clearInterval(anim); } }, 20);
                    el.onmousedown = (e) => { e.stopPropagation(); if (isVirus) { this.stats.cpu -= 10; this.float(e, "-10 CPU", "red"); } else if (this.stats.bw > 0) { this.stats.bw--; if (el.innerText === '$') { this.stats.credits += 30; this.float(e, "+30 $", "cyan"); } else { this.stats.food += 2; this.float(e, "+2 FOOD", "lime"); } } else this.float(e, "NO BW", "yellow"); this.updateStats(); el.remove(); clearInterval(anim); };
                    canvas.appendChild(el);
                }, 500);
            },
            scan: function () { this.state = GameState.SCANNING; this.render("SCANNING"); const g = document.getElementById('port-grid'); for (let i = 0; i < 24; i++) { const d = document.createElement('div'); d.className = 'port-cell'; d.innerText = Math.floor(Math.random() * 65535); const type = Math.random() > 0.7 ? (Math.random() > 0.5 ? 1 : 2) : 0; d.onclick = () => { if (d.classList.contains('open') || d.classList.contains('honey')) return; if (type === 0) { d.classList.add('closed'); d.style.color = "#555"; } else if (type === 1) { d.classList.add('open'); this.stats.credits += 50; this.updateStats(); } else { d.classList.add('honey'); this.stats.heat += 10; this.updateStats(); } }; g.appendChild(d); } },
            root: function () {
                if (Math.random() > 0.5) { this.puzzle("PASSWORD"); } else { this.state = GameState.HEXING; const target = "DEADBEEF"; this.render("HEXING", { target }); const g = document.getElementById('hex-grid'); for (let i = 0; i < 50; i++) { const s = document.createElement('span'); s.className = 'hex'; if (i === 25) { s.innerText = target; s.style.color = "white"; s.onclick = () => { alert("ROOT ACCESS GRANTED."); this.abort(); this.travel(); }; } else { s.innerText = Math.floor(Math.random() * 255).toString(16).toUpperCase(); s.onclick = () => { this.stats.cpu -= 5; this.updateStats(); alert("SEGFAULT -5 CPU"); }; } g.appendChild(s); g.appendChild(document.createTextNode(" ")); } }
            },
            puzzle: function (type) {
                this.state = GameState.PUZZLE; const p = { q: "", a: "" };
                if (type === "PASSWORD") { const pwds = ["GOD", "SEX", "LOVE", "SECRET"]; p.a = pwds[Math.floor(Math.random() * pwds.length)]; p.q = "ENTER PASSWORD:"; }
                else { const w = ["BACKBONE", "SPRAWL", "PHREAK"]; const wd = w[Math.floor(Math.random() * w.length)]; p.a = wd; p.q = "UNSCRAMBLE: " + wd.split('').sort(() => 0.5 - Math.random()).join(''); }
                this.currentPuz = { p: p, type: type }; this.render("PUZZLE", { p, type });
            },
            submitPuzzle: function () {
                const val = document.getElementById('ans').value.toUpperCase().trim();
                if (val === "HACK THE PLANET") { this.stats.bw = 99; this.stats.heat = 0; alert("HACK THE PLANET!"); this.abort(); return; }
                if (this.currentPuz && val === this.currentPuz.p.a) { this.abort(); this.travel(); }
                else { this.stats.heat += 20; alert("DENIED."); this.abort(); this.travel(); }
            },

            event: function () { const e = CHARACTERS[Math.floor(Math.random() * CHARACTERS.length)]; const res = e.e(this.stats); this.updateStats(); this.render("EVENT", { e, res }); },
            gibson: function () { this.render("GIBSON"); },

            // --- UTIL ---
            abort: function () { clearInterval(this.miningInt); clearInterval(this.timerInt); this.state === GameState.ROUTER ? this.travel() : this.render("ROOT_BOX"); },
            float: function (e, t, c) { const d = document.createElement('div'); d.className = 'float-txt'; d.innerText = t; d.style.color = c; d.style.left = e.clientX + 'px'; d.style.top = e.clientY + 'px'; document.body.appendChild(d); setTimeout(() => d.remove(), 800); },
            updateStats: function () { document.getElementById('val-cpu').innerText = this.stats.cpu + '%'; document.getElementById('val-cash').innerText = this.stats.credits; document.getElementById('val-food').innerText = this.stats.food; document.getElementById('val-bw').innerText = this.stats.bw; document.getElementById('val-heat').innerText = this.stats.heat + '%'; document.getElementById('path-disp').innerText = this.stats.path; },
            gameOver: function (r) { document.getElementById('main-display').innerHTML = `<h1 class="plague">TERMINATED</h1><p>${r}</p><button onclick="location.reload()">REBOOT</button>`; },

            render: function (id, data) {
                const d = document.getElementById('main-display'); document.getElementById('loc-disp').innerText = id; d.innerHTML = '';
                if (id === "MENU") d.innerHTML = `<div style="text-align:center;padding-top:20px;"><h1 class="glitch" data-text="HACKER TRAIL">HACKER TRAIL</h1><h3 class="cool">v2.8 PAC-MAN BOSS</h3><button onclick="Game.start()">BOOT</button></div>`;
                else if (id === "STORE") d.innerHTML = `<h2 class="burn">DARKNET</h2><p class="instruction">GOAL: Buy supplies.</p><div style="display:grid;grid-template-columns:1fr 1fr;"><button onclick="Game.buy('proxy')">PROXY $100</button><button onclick="Game.buy('food')">JOLT $20</button><button onclick="Game.buy('bw')">BW $50</button><button onclick="Game.buy('cool')">FAN $200</button></div><br><button onclick="Game.travel()">JACK IN</button>`;
                else if (id === "ROOT_BOX") { const tgt = TARGETS[Math.floor(Math.random() * TARGETS.length)]; d.innerHTML = `<h2 class="glitch" data-text="ROOTED">ROOTED</h2><p>TARGET: <span class="plague">${tgt.n}</span></p><p>VULN: ${tgt.v}</p><button onclick="Game.mine()">FARM (MINE)</button><button onclick="Game.scan()">RECON (SCAN)</button><button onclick="Game.root()">PIVOT (ROOT)</button>`; }
                else if (id === "MINING") d.innerHTML = `<div style="display:flex;justify-content:space-between"><span>MINING...</span><span id="timer" class="burn">30s</span></div><p class="instruction">GOAL: Click $ and D. AVOID RED VIRUSES.</p><div id="mining-canvas"></div><button onclick="Game.abort()">EXIT</button>`;
                else if (id === "SCANNING") d.innerHTML = `<h2>PORT SCAN</h2><p class="instruction">GOAL: Click OPEN ports.</p><div id="port-grid"></div><button onclick="Game.abort()">EXIT</button>`;
                else if (id === "HEXING") d.innerHTML = `<h2>BUFFER OVERFLOW</h2><p class="instruction">GOAL: Click the target string: ${data.target}</p><p>Find: <span class="burn">${data.target}</span></p><div id="hex-grid"></div><button onclick="Game.abort()">EXIT</button>`;
                else if (id === "COOKIE") d.innerHTML = `<div id="cookie-monster"><div class="eyes">OO</div><h1>GIVE ME COOKIE!</h1><p class="instruction">GOAL: Type 'COOKIE'!</p><input id="cookie-input" onkeyup="Game.checkCookie()" autofocus></div>`;
                else if (id === "RABBIT") d.innerHTML = `<h2 class="plague">RABBIT VIRUS DETECTED!</h2><p class="instruction">GOAL: Close windows.</p>`;
                else if (id === "PUZZLE") d.innerHTML = `<h2 class="cool">${data.type === "PASSWORD" ? "PASSWORD CRACK" : "ROUTER NODE"}</h2><p class="burn">${data.p.q}</p><input id="ans"><button onclick="Game.submitPuzzle()">SEND</button>`;
                else if (id === "EVENT") d.innerHTML = `<h2 class="cool">${data.e.t}</h2><p>${data.e.text}</p><p class="burn">${data.res}</p><button onclick="Game.render('ROOT_BOX')">OK</button>`;
                else if (id === "GIBSON") d.innerHTML = `<h1 class="plague">THE GIBSON</h1><p class="instruction">GOAL: EAT ALL BYTES. AVOID DEFENDERS.</p><p>Use Arrows to Move.</p><button onclick="Game.startPacman()">START HACK</button>`;
                else if (id === "PACMAN") d.innerHTML = `<h2>GIBSON CORE MEMORY</h2><p class="instruction">ARROWS to Move. Eat Dots.</p><canvas id="pacman-canvas" width="600" height="400"></canvas>`;
            },

            buy: function (t) { if (t === 'proxy' && this.stats.credits >= 100) { this.stats.credits -= 100; this.stats.proxies++; } if (t === 'food' && this.stats.credits >= 20) { this.stats.credits -= 20; this.stats.food += 5; } if (t === 'bw' && this.stats.credits >= 50) { this.stats.credits -= 50; this.stats.bw += 20; } if (t === 'cool' && this.stats.credits >= 200) { this.stats.credits -= 200; this.stats.heat = 0; } this.updateStats(); }
        };

        window.onload = () => Game.init();
    </script>
</body>

</html>